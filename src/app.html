<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/png" href="/static/HLX-black.png" crossorigin="use-credentials" />
		<link
			rel="icon"
			type="image/png"
			href="/static/HLX-black.png"
			sizes="96x96"
			crossorigin="use-credentials"
		/>
		<link rel="shortcut icon" href="/static/HLX-black.png" crossorigin="use-credentials" />
		<link
			rel="apple-touch-icon"
			sizes="180x180"
			href="/static/HLX-black.png"
			crossorigin="use-credentials"
		/>
		<link rel="manifest" href="/manifest.json" crossorigin="use-credentials" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover"
		/>
		<meta name="theme-color" content="#2e293a" />
		<meta name="robots" content="noindex,nofollow" />

		<!-- Anurati Font - Preload for splash screen -->
		<link rel="preload" href="/static/assets/fonts/Anurati.otf" as="font" type="font/otf" crossorigin>
		
		<style>
			@font-face {
				font-family: 'Anurati';
				src: url('/static/assets/fonts/Anurati.otf') format('opentype');
				font-weight: normal;
				font-style: normal;
				font-display: block;
			}
		</style>

		<!-- External CSS (editable without full rebuild via volume mount) -->
		<link rel="stylesheet" href="/static/splash.css" crossorigin="use-credentials" />
		<link rel="stylesheet" href="/static/custom.css" crossorigin="use-credentials" />
		<script src="/static/loader.js" defer crossorigin="use-credentials"></script>

		<script>
			function resizeIframe(obj) {
				obj.style.height = obj.contentWindow.document.documentElement.scrollHeight + 'px';
			}
		</script>

		<script>
			// On page load or when changing themes, best to add inline in `head` to avoid FOUC
			(() => {
				const metaThemeColorTag = document.querySelector('meta[name="theme-color"]');
				const prefersDarkTheme = window.matchMedia('(prefers-color-scheme: dark)').matches;

				if (!localStorage?.theme) {
					localStorage.theme = 'system';
				}

				if (localStorage.theme === 'system') {
					document.documentElement.classList.add(prefersDarkTheme ? 'dark' : 'light');
					metaThemeColorTag.setAttribute('content', prefersDarkTheme ? '#2e293a' : '#f5f3f7');
				} else if (localStorage.theme === 'oled-dark') {
					document.documentElement.style.setProperty('--color-gray-800', '#1c1926');
					document.documentElement.style.setProperty('--color-gray-850', '#151320');
					document.documentElement.style.setProperty('--color-gray-900', '#0f0d17');
					document.documentElement.style.setProperty('--color-gray-950', '#0a0910');
					document.documentElement.classList.add('dark');
					metaThemeColorTag.setAttribute('content', '#0a0910');
				} else if (localStorage.theme === 'light') {
					document.documentElement.classList.add('light');
					metaThemeColorTag.setAttribute('content', '#f5f3f7');
				} else if (localStorage.theme === 'her') {
					document.documentElement.classList.add('her');
					metaThemeColorTag.setAttribute('content', '#983724');
				} else {
					document.documentElement.classList.add('dark');
					metaThemeColorTag.setAttribute('content', '#2e293a');
				}

				window.matchMedia('(prefers-color-scheme: dark)').addListener((e) => {
					if (localStorage.theme === 'system') {
						if (e.matches) {
							document.documentElement.classList.add('dark');
							document.documentElement.classList.remove('light');
							metaThemeColorTag.setAttribute('content', '#2e293a');
						} else {
							document.documentElement.classList.add('light');
							document.documentElement.classList.remove('dark');
							metaThemeColorTag.setAttribute('content', '#f5f3f7');
						}
					}
				});
			})();
		</script>

		<title>Obsidian</title>

		%sveltekit.head%
		
		<!-- Splash screen controller - MUST be inline to work before app loads -->
		<script>
			(function() {
				// ===== SPLASH TIMING CONFIG =====
				const SPLASH_MIN_TIME = 4000;  // 4 seconds minimum display
				const FADE_DURATION = 800;     // 0.8 second fade out
				// ================================
				
				let appReady = false;
				let minTimeElapsed = false;
				
				const hideSplash = function() {
					// Only hide when BOTH conditions are met
					if (!appReady || !minTimeElapsed) return;
					
					const splash = document.getElementById('splash-screen');
					if (splash && !splash.classList.contains('hiding')) {
						splash.classList.add('hiding');
						splash.style.transition = 'opacity ' + FADE_DURATION + 'ms ease-out';
						splash.style.opacity = '0';
						setTimeout(function() {
							splash.style.display = 'none';
							splash.remove();
						}, FADE_DURATION);
					}
				};
				
				// Timer: minimum display time (4 seconds)
				setTimeout(function() {
					minTimeElapsed = true;
					console.log('[Splash] Min time elapsed');
					hideSplash();
				}, SPLASH_MIN_TIME);
				
				// Listen for app-ready event from Svelte layout
				window.addEventListener('app-ready', function() {
					console.log('[Splash] App ready event received');
					appReady = true;
					hideSplash();
				});
				
				// Fallback: if app-ready never fires, hide after extended time
				setTimeout(function() {
					if (!appReady) {
						console.log('[Splash] Fallback timeout - forcing ready');
						appReady = true;
						hideSplash();
					}
				}, 10000); // 10 second fallback
			})();
		</script>
	</head>

	<body data-sveltekit-preload-data="hover">
		<!-- Splash Screen - MUST be inline HTML to render before JS -->
		<div id="splash-screen">
			<div class="splash-grid"></div>
			<div class="splash-glow"></div>
			
			<div class="splash-content">
				<div class="splash-logo-container">
					<img 
						id="splash-logo" 
						src="/static/HLX-white.png" 
						alt="Obsidian"
						class="splash-logo"
					/>
					<div class="splash-logo-glow"></div>
				</div>
				
				<div class="splash-title-container">
					<h1 class="splash-title">OBSIDIAN</h1>
					<div class="splash-subtitle">INTELLIGENCE PLATFORM</div>
				</div>
				
				<div class="splash-loader">
					<div class="splash-loader-track">
						<div class="splash-loader-bar"></div>
						<div class="splash-loader-glow"></div>
					</div>
					<div class="splash-loader-text">INITIALIZING SYSTEM</div>
				</div>
			</div>
			
			<div class="splash-corner splash-corner-tl"></div>
			<div class="splash-corner splash-corner-tr"></div>
			<div class="splash-corner splash-corner-bl"></div>
			<div class="splash-corner splash-corner-br"></div>
		</div>

		<div style="display: contents">%sveltekit.body%</div>
	</body>

	<style type="text/css" nonce="">
		html {
			overflow-y: hidden !important;
			overscroll-behavior-y: none;
		}
	</style>
</html>
